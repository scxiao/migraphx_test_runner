
MIGRAPHFOLDER=/home/scxiao/Workplace/projects/MIGraph
MIGRAPHINCLUDE= -I$(MIGRAPHFOLDER)/src/include \
                -I$(MIGRAPHFOLDER)/src/targets/gpu/include \
                -I$(MIGRAPHFOLDER)/src/targets/cpu/include \
                -I$(MIGRAPHFOLDER)/test/include \
                -I$(MIGRAPHFOLDER)/deps/include

MIGRAPHLIBDIR = -L $(MIGRAPHFOLDER)/build/src/onnx -L $(MIGRAPHFOLDER)/build/src -L$(MIGRAPHFOLDER)/build/src/targets/gpu -L$(MIGRAPHFOLDER)/build/src/targets/cpu
MIGRAPHLIBS = -lmigraphx -lmigraphx_cpu -lmigraphx_device -lmigraphx_gpu -lmigraphx_onnx
CXXFLAGS=-g -std=c++14 ${MIGRAPHINCLUDE}
MIGRAPHLIBPATH = /home/scxiao/Workplace/software/migraphlibs

EXE_FILES = myAdd mySin mySinGpu load_onnx myConv2d testTypename test_char_rnn test_shape test_gather
all: create copy $(EXE_FILES)

SOURCE_FILES=myAdd.cpp \
    mySin.cpp \
    mySinGpu.cpp \
    load_onnx.cpp \
    myConvolution.cpp \
    testTypename.cpp \
    test_char_rnn.cpp \
    test_shape.cpp \
    test_gather.cpp

OBJ_FILES=$(SOURCE_FILES:.cpp=.o)

OBJ=obj
$(OBJ)/%.o : %.cpp
	$(CXX) -c -o $@ $< $(CXXFLAGS)

test_gather: test_gather.o
	$(CXX) -o $@ $^ ${MIGRAPHLIBDIR} ${MIGRAPHLIBS} 

test_shape: test_shape.o
	$(CXX) -o $@ $^ ${MIGRAPHLIBDIR} ${MIGRAPHLIBS} 

test_char_rnn: test_char_rnn.o
	$(CXX) -o $@ $^ ${MIGRAPHLIBDIR} ${MIGRAPHLIBS} 

testTypename: testTypename.o
	$(CXX) -o $@ $^ ${MIGRAPHLIBDIR} ${MIGRAPHLIBS} 

myConv2d: myConvolution.o
	$(CXX) -o $@ $^ ${MIGRAPHLIBDIR} ${MIGRAPHLIBS} 

load_onnx: load_onnx.o
	$(CXX) -o $@ $^ ${MIGRAPHLIBDIR} ${MIGRAPHLIBS} 

myAdd: myAdd.o
	$(CXX) -o $@ $^ ${MIGRAPHLIBDIR} ${MIGRAPHLIBS} 

mySin: mySin.o
	$(CXX) -o $@ $^ ${MIGRAPHLIBDIR} ${MIGRAPHLIBS} 

mySinGpu: mySinGpu.o
	$(CXX) -o $@ $^ ${MIGRAPHLIBDIR} ${MIGRAPHLIBS} 

create:
	if [ ! -d "./obj" ]; then \
		mkdir obj;\
	fi

copy:
	cp $(MIGRAPHFOLDER)/build/src/onnx/libmigraphx_onnx.so $(MIGRAPHLIBPATH)/.
	cp $(MIGRAPHFOLDER)/build/src/libmigraphx.so $(MIGRAPHLIBPATH)/.
	cp $(MIGRAPHFOLDER)/build/src/targets/cpu/libmigraphx_cpu.so $(MIGRAPHLIBPATH)/.
	cp $(MIGRAPHFOLDER)/build/src/targets/gpu/libmigraphx_gpu.so $(MIGRAPHLIBPATH)/.
	cp $(MIGRAPHFOLDER)/build/src/targets/gpu/libmigraphx_device.so $(MIGRAPHLIBPATH)/.

clean:
	rm -rf *.o $(EXE_FILES)
